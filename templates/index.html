<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>HelloChat</title>
<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
<style>
*{box-sizing:border-box;font-family:"Segoe UI",Arial,sans-serif}
body{
  margin:0;height:100vh;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  display:flex;justify-content:center;align-items:center
}
#chat-container{
  width:380px;height:600px;background:#111;border-radius:15px;
  display:flex;flex-direction:column;overflow:hidden;
  box-shadow:0 0 30px rgba(0,0,0,.6)
}
#chat-header{
  padding:15px;background:#1f1f1f;text-align:center;
  font-size:20px;font-weight:bold;color:#4cafef
}
#messages{
  flex:1;padding:15px;overflow-y:auto;background:#0b0b0b
}
.message{
  margin-bottom:10px;padding:10px 12px;border-radius:10px;
  max-width:80%;word-wrap:break-word;
  animation:fadeIn .2s ease
}
.message.user{
  background:#4cafef;color:#000;margin-left:auto;text-align:right
}
.message.other{
  background:#2a2a2a;color:#fff;margin-right:auto
}
#chat-input{
  display:flex;padding:10px;background:#1a1a1a
}
#chat-input input{
  flex:1;padding:10px;border:none;border-radius:8px;
  outline:none;background:#2a2a2a;color:#fff
}
#chat-input button{
  margin-left:10px;padding:10px 16px;border:none;border-radius:8px;
  background:#4cafef;color:#000;cursor:pointer;font-weight:bold
}
#chat-input button:hover{background:#6cc6ff}

#login{
  position:absolute;inset:0;background:rgba(0,0,0,.9);
  display:flex;justify-content:center;align-items:center
}
#login-box{
  background:#1a1a1a;padding:25px;border-radius:12px;
  text-align:center;width:280px
}
#login-box h2{margin-bottom:15px;color:#4cafef}
#login-box input{
  width:100%;padding:10px;border:none;border-radius:8px;
  margin-bottom:10px;background:#2a2a2a;color:#fff
}
#login-box button{
  width:100%;padding:10px;border:none;border-radius:8px;
  background:#4cafef;color:#000;font-weight:bold;cursor:pointer
}

@keyframes fadeIn{
  from{opacity:0;transform:translateY(5px)}
  to{opacity:1;transform:translateY(0)}
}
</style>
</head>
<body>

<div id="chat-container">
  <div id="chat-header">ðŸ’¬ HelloChat</div>
  <div id="messages"></div>
  <div id="chat-input">
    <input id="message" placeholder="Ã‰cris un message..." autocomplete="off">
    <button onclick="sendMessage()">Envoyer</button>
  </div>
</div>

<div id="login">
  <div id="login-box">
    <h2>Connexion</h2>
    <input id="usernameInput" placeholder="Ton pseudo">
    <button onclick="login()">Entrer</button>
  </div>
</div>

<script>
const socket = io();

let username = localStorage.getItem("username") || "";

const messages = document.getElementById('messages');
const messageInput = document.getElementById('message');
const loginDiv = document.getElementById('login');
const usernameInput = document.getElementById('usernameInput');

// Si dÃ©jÃ  connectÃ© avant, on cache le login
if (username !== "") {
  loginDiv.style.display = "none";
}

function login() {
  const u = usernameInput.value.trim();
  if (u !== "") {
    username = u;
    localStorage.setItem("username", username);
    loginDiv.style.display = "none";
  }
}

function addMessage(text, type) {
  const div = document.createElement('div');
  div.className = 'message ' + type;
  div.textContent = text;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}

// ðŸ“œ RÃ©ception de l'historique
socket.on('history', history => {
  messages.innerHTML = "";
  history.forEach(data => {
    if (data.user === username) {
      addMessage("Moi : " + data.text, "user");
    } else {
      addMessage(data.user + " : " + data.text, "other");
    }
  });
});

// ðŸ’¬ RÃ©ception des nouveaux messages
socket.on('message', data => {
  if (data.user === username) {
    addMessage("Moi : " + data.text, "user");
  } else {
    addMessage(data.user + " : " + data.text, "other");
  }
});

// ðŸ“¤ Envoi d'un message
function sendMessage() {
  const msg = messageInput.value.trim();
  if (msg !== "" && username !== "") {
    socket.emit('message', { user: username, text: msg });
    messageInput.value = "";
  }
}

// âŽ Touche EntrÃ©e
messageInput.addEventListener("keypress", e => {
  if (e.key === "Enter") sendMessage();
});
</script>

</body>
</html>
